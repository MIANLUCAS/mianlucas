(function(){function e(){let e=document.getElementById("export");e&&e.addEventListener("click",e=>{e.preventDefault();let t=document.getElementById("export_items").checked,n=document.getElementById("export_settings").checked;if(t||n){let e={};t&&(e.items=JSON.parse(document.getElementById("data_items").innerText)),n&&(e.settings=JSON.parse(document.getElementById("data_settings").innerText));let o=`data:text/json;charset=utf-8, ${encodeURIComponent(JSON.stringify(e))}`,a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download","aio_contact_data.json"),document.body.appendChild(a),a.click(),a.remove()}else Swal.fire({type:"error",title:"Oops...",text:"Looks like you forgot to select what to Export"})})}function t(){var e=new Date,t=e.getTimezoneOffset(),n=t/60*-1;document.querySelector(`#avail_timezone option[value="${n}"]`)&&(document.querySelector(`#avail_timezone option[value="${n}"]`).selected=!0)}function n(){let e=window.location.href.split("#")[0],t=document.querySelectorAll(".aio-contact-menu a");t.forEach(t=>{t.href===e&&t.classList.add("active")})}function o(){return JSON.parse(document.getElementById("aio-contact-items").innerHTML)}function a(e){document.getElementById("aio-contact-items").innerHTML=JSON.stringify(e)}function i(){$("save_aio_contact_items",document.getElementById("aio-contact-items").innerHTML)}function c(){document.getElementById("item_title").value="",document.getElementById("item_icon").value="",document.querySelector("input[name=item_icon]").value="";let e=document.querySelector("[name=item_icon]");e.querySelector("i")&&(e.querySelector("i").className=""),document.getElementById("item_url").value="",document.getElementById("item_form").value="",document.getElementById("item_shortcode").value="",document.querySelector("#integration_field option[disabled]").selected=!0,document.querySelectorAll(".aio_contact_integration_fields").forEach(e=>{e.querySelectorAll("input").forEach(e=>{e.value=""})}),document.getElementById("agent_name").value="",document.getElementById("agent_avatar")&&(document.getElementById("agent_avatar_preview").removeAttribute("src"),document.getElementById("agent_avatar_id").value="");let t=["mon","tue","wed","thu","fri","sat","sun"];t.forEach(e=>{document.getElementById(`avail_${e}`).checked=!1}),document.getElementById("avail_start").value="",document.getElementById("avail_end").value="",document.getElementById("agent_url").value=""}function l(){document.querySelectorAll(".aio-contact-items > .col-xl-3").forEach(e=>{e.remove()});let e=o();e.forEach((e,t,n)=>{e.agents?(p(e,t,"aio"),e.agents.forEach(e=>{q(e,t)})):e.form?p(e,t,"cf7"):e.shortcode?p(e,t,"sc"):e.integration&&p(e,t,"integration",e.integration.type),t==n.length-1&&u()})}function d(e){document.querySelector(`#aio-contact-item-${e} .aio-contact-item-agents`).innerHTML="";let t=o();t[e].agents.forEach(t=>{q(t,e)}),0==t[e].agents.length&&(document.querySelector(`#aio-contact-item-${e} .aio-contact-item-agents`).innerHTML='<div class="aio-contact-item-no-agents aio-h-dim-text"><em>No Agents</em></div>')}function r(){g(),y(),v(),f(),_(),S(),I(),x(),s(),m()}function m(){document.querySelector("#item_integration")&&document.querySelector("#item_integration").addEventListener("change",()=>{document.querySelectorAll(".aio_contact_integration_fields").forEach(e=>{e.style.display="none"});let e=document.querySelector("#item_integration").value;document.querySelector(`#${e}_field`).style.display="block"})}function u(){S()}function s(){document.querySelector(".aio-contact-preloader")&&document.querySelector(".aio-contact-preloader").remove()}function g(){document.getElementById("aio-contact-save-items")&&document.getElementById("aio-contact-save-items").addEventListener("click",()=>{l(),i()})}function y(){let e=document.getElementById("border_radius"),t=document.getElementById("border_radius_value");e&&(e.addEventListener("input",()=>{t.value=e.value}),t.addEventListener("change",()=>{e.value=t.value}))}function v(){document.querySelectorAll('[data-dismiss="modal"]').forEach(e=>{e.addEventListener("click",()=>{c()})})}function f(){document.querySelector(".aio-contact-import-sample-items")&&document.querySelector(".aio-contact-import-sample-items").addEventListener("click",()=>{Swal.fire({title:"Are you sure?",text:"You will be able to delete the items which you don't need later",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, import!"}).then(e=>{if(e.value){let e=JSON.parse('[{"title":"WhatsApp","icon":"fab fa-whatsapp","color":"#1bd741","agents":[],"url":""},{"title":"Telegram","icon":"fab fa-telegram","color":"#0088cc","agents":[],"url":""},{"title":"Skype","icon":"fab fa-skype","color":"#01aee6","agents":[],"url":""},{"title":"Messenger","icon":"fab fa-facebook-messenger","color":"#0185ff","agents":[],"url":""},{"title":"Viber","icon":"fab fa-viber","color":"#7f51a4","agents":[],"url":""},{"title":"Email","icon":"fas fa-envelope","color":"#d80039","agents":[],"url":""}]');a(e),i(),l(),document.querySelector(".aio-contact-import-sample-items").remove(),Swal.fire("Imported!","Item has been successfully imported","success")}})})}function _(){document.getElementById("item_modal_action")&&document.getElementById("item_modal_action").addEventListener("click",()=>{let e=document.getElementById("item_modal_action");-1!==e.innerText.search("Add")?E(e.dataset.type):-1!==e.innerText.search("Edit")&&h(e.dataset.type)})}function E(e){if(""===document.getElementById("item_title").value)return void Swal.fire("Incomplete Fields!","Item Title cannot be blank","error");let t=o(),n={title:document.getElementById("item_title").value,icon:document.querySelector("input[name=item_icon]").value,color:document.getElementById("item_color").value};""!==n.icon&&"empty"!==n.icon||(n.icon="fas fa-stop"),"aio"===e?(n.agents=[],n.url=document.getElementById("item_url").value):"cf7"===e?n.form=document.getElementById("item_form").value:"sc"===e?n.shortcode=document.getElementById("item_shortcode").value:"integration"===e&&(n.integration={type:document.querySelector("#item_integration").value},"messenger"===n.integration.type?n.integration.page_id=document.querySelector("#messenger_page_id").value:"tawk"===n.integration.type&&(n.integration.widget_id=document.querySelector("#tawk_widget_id").value)),t.push(n),p(n,t.length-1,e),a(t),i(),c(),u(),document.querySelector('.show [data-dismiss="modal"]').click(),Swal.fire({title:"Success",text:"New Item has been added successfully.",type:"success",showConfirmButton:!1,timer:2e3})}function p(e,t,n){let o=document.createElement("div"),a="";"aio"===n?a=`\n            <div class="aio-contact-item-footer">\n                <div class="aio-contact-item-agents">\n                    <div class="aio-contact-item-no-agents aio-h-dim-text">\n                        <em>No Agents</em>\n                    </div>\n                </div>\n                <div class="aio-contact-item-actions">\n                    <div class="aio-contact-item-action aio-contact-agent-add aio-h-spin-hover" data-id="${t}">\n                        <div class="aio-contact-item-action-icon">\n                            <i class="fas fa-plus-circle"></i>\n                        </div>\n                        <div class="aio-contact-item-action-name">\n                            Add Agent\n                        </div>\n                    </div>\n                </div>\n            </div>`:"cf7"!==n&&"sc"!==n&&"integration"!==n||(a=`<div class="aio-contact-item-footer aio-contact-item-${n}"><div class="aio-contact-item-${"integration"===n?e.integration.type:n}-logo"></div></div>`),o.classList.add("col-xl-3","col-lg-4","col-md-6"),o.id=`aio-contact-item-${t}`,o.innerHTML=`\n            <div class="aio-contact-item">\n                <div class="aio-contact-item-header">\n                    <div class="aio-contact-item-text">\n                        <div class="aio-contact-item-icon" style="color: ${e.color}"> \n                            <i class="${e.icon}"></i>\n                        </div>\n                        <div class="aio-contact-item-title">\n                            ${e.title}\n                        </div>\n                    </div>\n                    <div class="aio-contact-item-actions">\n                        <div class="aio-contact-item-action aio-contact-item-action-edit text-success hvr-bob" data-type="${n}" data-id="${t}">\n                            <i class="fas fa-edit"></i>\n                        </div>\n                        <div class="aio-contact-item-action aio-contact-item-action-delete text-danger hvr-bob" data-id="${t}">\n                            <i class="fas fa-trash"></i>\n                        </div>\n                    </div>\n                </div>\n                ${a}\n            </div>\n        `,document.querySelector(".aio-contact-items").insertBefore(o,document.querySelector(".aio-contact-item-add").parentElement)}function h(e){if(""===document.getElementById("item_title").value)return void Swal.fire("Incomplete Fields!","Item Title cannot be blank","error");let t=o(),n=document.getElementById("item_modal_action").dataset.id;t[n].title=document.getElementById("item_title").value,t[n].icon=document.querySelector("input[name=item_icon]").value,t[n].color=document.getElementById("item_color").value,"aio"===e?t[n].url=document.getElementById("item_url").value:"cf7"===e?t[n].form=document.getElementById("item_form").value:"sc"===e&&(t[n].shortcode=document.getElementById("item_shortcode").value),""!==t[n].icon&&"empty"!==t[n].icon||(t[n].icon="fas fa-stop"),B(t[n],n),a(t),i(),c(),document.querySelector('.show [data-dismiss="modal"]').click(),Swal.fire({title:"Success",text:"Item has been edited successfully.",type:"success",showConfirmButton:!1,timer:2e3})}function B(e,t){let n=document.getElementById(`aio-contact-item-${t}`);n.querySelector(".aio-contact-item-icon").style.color=e.color,n.querySelector(".aio-contact-item-icon i").className=e.icon,n.querySelector(".aio-contact-item-title").innerHTML=e.title}function S(){document.querySelectorAll(".aio-contact-item-action-delete").forEach(e=>{e.addEventListener("click",()=>{Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.value){let t=JSON.parse(document.getElementById("aio-contact-items").innerHTML);t.splice(e.dataset.id,1),document.getElementById(`aio-contact-item-${e.dataset.id}`).remove(),document.getElementById("aio-contact-items").innerHTML=JSON.stringify(t),i(),l(),Swal.fire({title:"Success",text:"Item has been deleted successfully.",type:"success",showConfirmButton:!1,timer:2e3})}})})})}function I(){document.getElementById("agent_modal_action")&&document.getElementById("agent_modal_action").addEventListener("click",()=>{let e=document.getElementById("agent_modal_action").innerText;-1!==e.search("Add")?w():-1!==e.search("Edit")&&w(document.getElementById("agent_modal_action").dataset.id)})}function w(e=null){if(""===document.getElementById("agent_name").value||""===document.getElementById("agent_url").value)return void Swal.fire("Incomplete Fields!","Agent Name and URL cannot be blank","error");let t=[];document.querySelectorAll("[name=availability]").forEach(e=>{e.checked&&t.push(e.value)});let n=o(),l=document.getElementById("agent_item_id").value,d={name:document.getElementById("agent_name").value,avatar:document.getElementById("agent_avatar_preview").src,avatar_id:document.getElementById("agent_avatar_id").value,availability:{days:t,start:document.getElementById("avail_start").value,end:document.getElementById("avail_end").value,timezone:document.getElementById("avail_timezone").value},url:document.getElementById("agent_url").value};""===d.avatar&&(d.avatar="https://aio.thehp.in/avatar.png"),e?(n[l].agents[e]=d,b(d,e,l)):(n[l].agents.push(d),q(d,l)),a(n),i(),c(),document.querySelector('#addEditAgent [data-dismiss="modal"]').click(),Swal.fire({title:"Success",text:`Agent has been ${e?"edited":"added"} successfully.`,type:"success",showConfirmButton:!1,timer:2e3})}function q(e,t){let n=document.querySelectorAll(`#aio-contact-item-${t} .aio-contact-item-agent`).length,o=`\n        <div class="aio-contact-item-agent" id="aio-contact-item-agent-${n}" data-item-id="${t}" data-id="${n}">\n            <div class="aio-contact-item-agent-avatar">\n                <img src="${e.avatar}" width="30px" height="30px" alt="${e.name}">\n            </div>\n            <div class="aio-contact-item-agent-name">\n                ${e.name}\n            </div>\n        </div>\n        `,a=document.querySelector(`#aio-contact-item-${t} .aio-contact-item-agents`);a.querySelector(".aio-contact-item-no-agents")?a.innerHTML=o:a.innerHTML=a.innerHTML+o}function b(e,t,n){let o=document.querySelector(`#aio-contact-item-${n} #aio-contact-item-agent-${t}`);o.querySelector("img").src=e.avatar,o.querySelector("img").alt=e.name,o.querySelector(".aio-contact-item-agent-name").innerText=e.name}function x(){let e=document.querySelector(".aio-contact-agent-delete");e&&e.addEventListener("click",()=>{Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.value){let t=JSON.parse(document.getElementById("aio-contact-items").innerHTML);t[e.dataset.itemId].agents.splice(e.dataset.id,1),document.querySelector(`#aio-contact-item-${e.dataset.itemId} #aio-contact-item-agent-${e.dataset.id}`).remove(),document.getElementById("aio-contact-items").innerHTML=JSON.stringify(t),i(),d(e.dataset.itemId),document.querySelector('#addEditAgent [data-dismiss="modal"]').click(),Swal.fire({title:"Success",text:"Agent has been deleted successfully.",type:"success",showConfirmButton:!1,timer:2e3})}})})}async function $(e,t=""){if(e){await fetch(ajax_object.ajax_url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=${e}&data=${t}`}).then(e=>{200!==e.status&&L()}).catch(e=>{L()})}}function L(){Swal.fire({title:"Oops...",text:"We couldn't save your last action. Please refresh page to continue",type:"error",confirmButtonColor:"#3085d6",confirmButtonText:"Refresh"}).then(e=>{e.value&&location.reload()})}document.addEventListener("DOMContentLoaded",function(){n(),r(),t(),e()})})();